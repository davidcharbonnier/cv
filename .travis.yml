# Only build master branch that contains David's CV
branches:
  only:
  - master

os: linux
dist: xenial
language: shell

services:
- docker

before_install:
- mkdir output
- docker pull thomasweise/texlive

# Build doc twice to get \LastPage labels defined
script:
- mkdir /tmp/fonts
- curl https://github.com/FortAwesome/Font-Awesome/blob/master/otfs/Font%20Awesome%205%20Free-Regular-400.otf?raw=true --output /tmp/fonts/fontawesome.otf
- docker run -v ${PWD}:/doc/ -v /tmp/fonts/:/usr/share/fonts/external/ -ti thomasweise/texlive make cv resume
- docker run -v ${PWD}:/doc/ -v /tmp/fonts/:/usr/share/fonts/external/ -ti thomasweise/texlive make cv resume
- mv *.pdf output/

deploy:
  provider: s3
  bucket: davidcharbonnier-cv
  region: ca-central-1
  local_dir: output
  acl: public_read
  edge: true # opt in to dpl v2
